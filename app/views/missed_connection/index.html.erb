<script type="text/javascript">
  var map;

  function initialize() {
    var mapOptions = {
      zoom: 14,
      center: new google.maps.LatLng(40.7100474, -73.9263586)
    };
    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var markers = [
      <% @missed_connections.each do |missed_connection| %>
        {
          title: '<%= missed_connection.title %>',
          body: '<%= missed_connection.body %>',
          latitude: <%= missed_connection.latitude %>,
          longitude: <%= missed_connection.longitude %>
        },
      <% end %>
    ];

    for( i = 0; i < markers.length; i++ ) {
      var position = new google.maps.LatLng(markers[i].latitude, markers[i].longitude);

      marker = new google.maps.Marker({
        position: position,
        map: map,
        title: markers[i].title
      });

      var infoWindow = new google.maps.InfoWindow(), marker, i;

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infoWindow.setContent(marker.title);
          infoWindow.open(map, marker);
        }
      })(marker, i));
    }
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<%= link_to 'Sign up', new_user_registration_path %>

<div id="map-canvas"></div>
